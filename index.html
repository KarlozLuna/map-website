<!-- "StAuth10244: I Carlos Linares, 000929500 certify that this material is my original work. No other person's work has been used without due acknowledgement. I have not made my work available to anyone else." -->

<!DOCTYPE html>
<html lang="en">

<head>
  <title>Looking to play soccer</title>
  <style>
    #map {
      height: 60vh;
      width: 100%;
    }
  </style>
  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAYQbbcCVPMZIaAiXNU_-_TNHrt-O97iKs&loading=async&callback=initMap&libraries=marker"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

</head>

<body>
  <div class="text-center my-4">
    <h1 class="text-success display-1 display-ms-5 fw-bold">Looking to Play Soccer?</h1>
    <p class="text-secondary">Explore soccer fields, parks, and stadiums near you.</p>
  </div>
  <div id="map"></div>
  <div class="controls container mt-3 p-3 bg-light rounded shadow-sm">
    <div class="d-flex flex-wrap justify-content-center align-items-center gap-2">
      <button id="filter_outdoor" class="btn btn-success btn-sm">Play soccer outdoors</button>
      <button id="filter_indoor" class="btn btn-success btn-sm">Play soccer indoors</button>
      <button id="filter_stadium" class="btn btn-success btn-sm">Soccer stadium</button>
      <button id="add_marker" class="btn btn-primary btn-sm">Add your location</button>
      <select id="originSelect" class="form-select form-select-sm w-auto">
        <option value="">Select origin</option>
      </select>
      <select id="destinationSelect" class="form-select form-select-sm w-auto">
        <option value="">Select destination</option>
      </select>
      <button id="get_directions" class="btn btn-info btn-sm">Get Directions</button>
    </div>
  </div>


  <script>
    let map;
    let markers = [];
    let directionsService;
    let directionsRenderer;
    let userLocation = null;
    let locations = [];

    function initMap() {

      const center = { lat: 43.239177, lng: -79.8860931 };
      map = new google.maps.Map(document.getElementById("map"),
        {
          center: center,
          zoom: 12,
          mapId: "4cbec666ef77d72d81df906a"
        });

      directionsRenderer.setMap(map);

      locations = [
        { name: "Soccer Complex 1", lat: 43.246612, lng: -79.943835, type: "indoor", title: "Wentworth Sports Complex" },
        { name: "Soccer Complex 2", lat: 43.207247, lng: -79.948701, type: "indoor", title: "Redeemer Sports Complex" },
        { name: "Soccer Complex 3", lat: 43.2572472, lng: -79.8938379, type: "indoor", title: "Soccer World - Sports Complex" },
        { name: "Soccer Complex 4", lat: 43.2427237, lng: -79.9573752, type: "indoor", title: "Ancaster Sports Centre - Sports Complex" },
        { name: "Soccer Complex 5", lat: 43.239177, lng: -79.8860931, type: "indoor", title: "DBARC at Mohawak College" },
        { name: "Stadium 1", lat: 43.2523634, lng: -79.8310486, type: "stadium", title: "Hamilton Stadium" },
        { name: "Soccer Park 1", lat: 43.2403817, lng: -79.897902, type: "outdoor", title: "Hillfield Soccer Park" },
        { name: "Soccer Park 2", lat: 43.225783, lng: -79.8485045, type: "outdoor", title: "Macassa Park" },
        { name: "Soccer Park 3", lat: 43.2484855, lng: -79.8628515, type: "outdoor", title: "Corktown Park" },
        { name: "Soccer Park 4", lat: 43.2589577, lng: -79.8442178, type: "outdoor", title: "Woodlands Park" }
      ];

      locations.forEach((loc, index) => {
        const marker = new google.maps.marker.AdvancedMarkerElement({
          map: map,
          position: { lat: loc.lat, lng: loc.lng },
          title: loc.title,
        });
        marker.type = loc.type;
        markers.push(marker);

      });



    }

    // Add marker for user location with a different icon 
    function addMarkerUserLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            userLocation = {
              name: "Your Location",
              lat: position.coords.latitude,
              lng: position.coords.longitude,
              type: "user",
            };

            const marker = new google.maps.marker.AdvancedMarkerElement({
              map: map,
              position: userLocation,
              title: "Your Location",
              content: (() => {
                const img = document.createElement("img");
                img.src = "https://icon-library.com/images/drop-pin-icon-png/drop-pin-icon-png-21.jpg";
                img.style.width = "40px";
                img.style.height = "40px";
                img.style.borderRadius = "50%";
                img.style.objectFit = "cover";
                return img;
              })(),
            });

            markers.push(marker);
            locations.push(userLocation);

            populateDropdowns();
            map.setCenter(userLocation);
            map.setZoom(13);
          },
          () => {
            alert("Error adding your location!");
          }
        );
      }
    }

    function populateDropdowns() {
      const originSelect = document.getElementById("originSelect");
      const destinationSelect = document.getElementById("destinationSelect");

      originSelect.innerHTML = '<option value="">Select origin</option>';
      destinationSelect.innerHTML = '<option value="">Select destination</option>';

      locations.forEach((loc, index) => {
        const option1 = new Option(loc.name, index);
        const option2 = new Option(loc.name, index);
        originSelect.add(option1);
        destinationSelect.add(option2);
      });
    }


      // Show direction between the locations to play soccer and the user location
      function showDirections() {
        const originIndex = document.getElementById("originSelect").value;
        const destinationIndex = document.getElementById("destinationSelect").value;

        if (originIndex === "" || destinationIndex === "") {
          alert("Please select both origin and destination!");
          return;
        }

        const origin = locations[originIndex];
        const destination = locations[destinationIndex];

        const request = {
          origin: { lat: origin.lat, lng: origin.lng },
          destination: { lat: destination.lat, lng: destination.lng },
          travelMode: "DRIVING",
        };

        directionsService.route(request, function (result, status) {
          if (status === "OK") {
            directionsRenderer.setDirections(result);
          } else {
            alert("Request Error");
          }
        });
      }

      function filterOutdoor() {
        for (let i = 0; i < markers.length; i++) {
          if (markers[i].type === "outdoor") {
            markers[i].map = map;
          } else {
            markers[i].map = null;
          }
        }
      }

      function filterIndoor() {
        for (let i = 0; i < markers.length; i++) {
          if (markers[i].type === "indoor") {
            markers[i].map = map;
          } else {
            markers[i].map = null;
          }
        }
      }

      function filterStadium() {
        for (let i = 0; i < markers.length; i++) {
          if (markers[i].type === "stadium") {
            markers[i].map = map;
          } else {
            markers[i].map = null;
          }
        }
      }

  </script>
</body>

</html>